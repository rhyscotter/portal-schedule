<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Schedule List</title>
<style>
:root{
  --bg:#000; --card:#111; --border:#1e1e1e; --text:#fff; --muted:#8a8a8a;
  --accent:#7B2EFF; --accent2:#B266FF;
  --gameday:var(--accent); --gameday2:var(--accent2);
  --clubGlow: rgba(123,46,255,.18);
}
*{box-sizing:border-box}
body{margin:0;background:transparent;color:var(--text);font-family:Arial,sans-serif}
.stage{
  min-height:100vh;padding:22px;
  background:radial-gradient(1000px 600px at 20% -10%, rgba(255,255,255,.05), transparent 60%),
            linear-gradient(180deg,#000 0%,#050505 100%);
  position:relative;overflow:hidden;
}
.stage::before{
  content:"";position:absolute;inset:-40% -20%;transform:rotate(-14deg);
  background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.05), rgba(255,255,255,0));
  opacity:.18;pointer-events:none;
}
.wrap{max-width:900px;margin:0 auto;position:relative;z-index:2}
.teamName{font-family:Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif;font-size:44px;text-transform:uppercase;letter-spacing:1px;line-height:1}
.sub{margin-top:8px;color:var(--muted);font-size:14px}
.gameday{
  margin-top:18px;padding:14px;border-radius:18px;
  background:linear-gradient(90deg,var(--gameday),var(--gameday2));
  position:relative;overflow:hidden;
  animation:gamedayGlow 2.4s ease-in-out infinite;
  box-shadow:0 0 12px color-mix(in srgb, var(--gameday) 35%, transparent),
             0 0 50px color-mix(in srgb, var(--gameday2) 25%, transparent);
  display:none;
}
.gameday.on{display:block}
.gameday::before{
  content:"";position:absolute;inset:0;
  background:linear-gradient(120deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
  transform:translateX(-70%);animation:sweep 2.8s linear infinite;opacity:.9;pointer-events:none;
}
@keyframes sweep{0%{transform:translateX(-70%)}100%{transform:translateX(70%)}}
@keyframes gamedayGlow{0%{filter:brightness(1)}50%{filter:brightness(1.12)}100%{filter:brightness(1)}}
.gTitle{font-family:Impact,sans-serif;text-transform:uppercase;letter-spacing:1px;font-size:18px;position:relative;z-index:2}
.gSub{margin-top:4px;color:rgba(255,255,255,.88);font-size:13px;position:relative;z-index:2}
.energyBar{height:3px;border-radius:999px;margin-top:10px;background:linear-gradient(90deg,var(--gameday),var(--gameday2));
  animation:energyPulse 1.8s ease-in-out infinite;position:relative;z-index:2}
@keyframes energyPulse{0%{opacity:.6;transform:scaleX(.98)}50%{opacity:1;transform:scaleX(1)}100%{opacity:.6;transform:scaleX(.98)}}
.list{margin-top:18px;display:flex;flex-direction:column;gap:12px}
.card{
  background:rgba(17,17,17,.85);border:1px solid rgba(255,255,255,.10);
  border-radius:16px;padding:16px;position:relative;overflow:hidden;
  transition:.18s ease;cursor:pointer;
}
.card:hover{background:rgba(26,26,26,.9);transform:translateY(-2px);border-color:rgba(255,255,255,.16)}
.card::before{content:"";position:absolute;inset:-50% -20%;transform:rotate(-12deg);
  background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.05), rgba(255,255,255,0));
  opacity:.28;pointer-events:none;}
.row{display:flex;justify-content:space-between;gap:12px;align-items:flex-start;position:relative;z-index:2}
.title{font-family:Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif;font-size:28px;text-transform:uppercase;position:relative;padding-bottom:6px;letter-spacing:.6px}
.title::after{content:"";position:absolute;left:0;bottom:0;height:4px;width:100%;border-radius:999px;
  background:linear-gradient(90deg,var(--gameday),transparent);
  transform:scaleX(0);transform-origin:left;transition:.22s ease}
.card:hover .title::after{transform:scaleX(1)}
.pill{font-size:11px;font-weight:900;letter-spacing:.8px;text-transform:uppercase;padding:7px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);color:rgba(255,255,255,.86);white-space:nowrap}
.pill.game{border-color:color-mix(in srgb, var(--gameday) 60%, transparent);background:color-mix(in srgb, var(--gameday) 18%, transparent)}
.meta{margin-top:10px;color:rgba(255,255,255,.72);font-size:13px;line-height:1.45;position:relative;z-index:2}
.err{margin-top:16px;color:#fff;background:rgba(255,0,0,.12);border:1px solid rgba(255,0,0,.35);padding:12px;border-radius:14px}
</style>
</head>

<body>
<div class="stage"><div class="wrap">
  <div class="teamName" id="teamName">Schedule</div>
  <div class="sub" id="sub">Waiting for data‚Ä¶</div>

  <div class="gameday" id="gameday">
    <div class="gTitle">Game Day Mode</div>
    <div class="gSub" id="gamedaySub">‚Äî</div>
    <div class="energyBar"></div>
  </div>

  <div class="list" id="list"></div>
  <div id="err"></div>
</div></div>

<script>
// ‚úÖ Keep your fallback mapping (optional)
const CLUB_THEMES = {
  default: { accent:"#7B2EFF", accent2:"#B266FF", bgGlow:"rgba(123,46,255,.18)" },
  cherrybrook: { accent:"#C8102E", accent2:"#FF4B5C", bgGlow:"rgba(200,16,46,.20)" },
  rumson: { accent:"#FFFFFF", accent2:"#BDBDBD", bgGlow:"rgba(255,255,255,.10)" },
  monmouth: { accent:"#00E5FF", accent2:"#00A3FF", bgGlow:"rgba(0,229,255,.18)" }
};

// ‚úÖ prefer payload.theme from parent (Wix), fallback to CLUB_THEMES
function applyThemeFromPayload(payload){
  const slug = String(payload?.clubSlug || "default").trim().toLowerCase();
  const fallback = CLUB_THEMES[slug] || CLUB_THEMES.default;

  const t = payload?.theme || null;

  const accent  = (t?.accent  || fallback.accent);
  const accent2 = (t?.accent2 || fallback.accent2 || accent);
  const glow    = (t?.glow    || fallback.bgGlow || "rgba(123,46,255,.18)");

  const r = document.documentElement.style;
  r.setProperty("--accent", accent);
  r.setProperty("--accent2", accent2);
  r.setProperty("--gameday", accent);
  r.setProperty("--gameday2", accent2);
  r.setProperty("--clubGlow", glow);

  // ‚úÖ Debug (NO undefined refs)
  console.log("üóìÔ∏è IFRAME THEME SET:", {
    accent,
    accent2,
    glow,
    clubSlug: slug,
    hasTheme: !!t
  });
}

const $teamName = document.getElementById("teamName");
const $sub = document.getElementById("sub");
const $list = document.getElementById("list");
const $err = document.getElementById("err");
const $gd = document.getElementById("gameday");
const $gdSub = document.getElementById("gamedaySub");

function fmt(dt){
  const d = new Date(dt);
  return new Intl.DateTimeFormat(undefined,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}).format(d);
}
function safe(s){ return String(s??"").replace(/[<>]/g,""); }

function renderList(events){
  $list.innerHTML = "";
  const sorted = (events||[]).slice().sort((a,b)=>new Date(a.dateTime)-new Date(b.dateTime));

  // Game Day banner = next game
  const nextGame = sorted.find(e => String(e.eventType||"").toLowerCase() === "game");
  if (nextGame){
    $gd.classList.add("on");
    const opp = nextGame.opponent ? ` vs ${nextGame.opponent}` : "";
    $gdSub.textContent = `${fmt(nextGame.dateTime)} ‚Ä¢ ${nextGame.location || ""}${opp}`;
  } else {
    $gd.classList.remove("on");
  }

  sorted.forEach(e => {
    const type = String(e.eventType||"").toLowerCase();
    const title = type === "game" ? `Game${e.opponent ? " vs " + e.opponent : ""}` : (e.eventType || "Event");
    const el = document.createElement("div");
    el.className = "card";
    el.onclick = () => window.parent.postMessage({ type:"OPEN_EVENT", eventId: e._id }, "*");

    el.innerHTML = `
      <div class="row">
        <div class="title">${safe(title)}</div>
        <div class="pill ${type==="game"?"game":""}">${safe(type || "event")}</div>
      </div>
      <div class="meta">
        <strong>${safe(fmt(e.dateTime))}</strong><br>
        ${safe(e.location || "")}${e.attendanceExpected ? `<br>Expected: ${safe(e.attendanceExpected)}` : ""}
      </div>
    `;
    $list.appendChild(el);
  });
}

window.addEventListener("message", (ev) => {
  const data = ev.data;
  if (!data) return;

  if (data.type === "SCHEDULE_ERROR"){
    $err.innerHTML = `<div class="err">${safe(data.message)}</div>`;
    return;
  }

  if (data.type !== "SCHEDULE_INIT") return;

  // theme (from parent) -> CSS variables
  applyThemeFromPayload(data);

  $teamName.textContent = "Schedule";
  $sub.textContent = `Loaded ${data.events?.length || 0} event(s)`;

  renderList(data.events || []);
});

// Optional handshake (some pages use it)
try { window.parent.postMessage({ type:"IFRAME_READY" }, "*"); } catch(_) {}
</script>
</body>
</html>
